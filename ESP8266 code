
#include <Wire.h>
#include <LiquidCrystal_I2C.h>

#include "FirebaseESP8266.h"
#include <ESP8266WiFi.h>

#define FIREBASE_HOST "esp8266firebase-c0d21-default-rtdb.firebaseio.com/"
#define FIREBASE_AUTH "H1LIBMkrhFGq0gaONtIso13ad7RACrtjdxboJwUN"
#define WIFI_SSID "abc"
#define WIFI_PASSWORD "11111111"

LiquidCrystal_I2C lcd(32, 16, 2);


void setup(){
  
  float voltBin = analogRead(A0);
  float batteryVolt = 5;
  float volt = batteryVolt * voltBin / 1024;
  float battery = 100 * (volt-0.2) / 1.3;
  
  // LCD initialization
  lcd.begin(16,2); // LCD size
  lcd.init();
  lcd.backlight();
  // Serial.begin(9600);
  
  // LCD print
  lcd.setCursor(0,0);
  lcd.print(volt);
  lcd.print(" V");
  lcd.setCursor(0,1);
  lcd.print(battery);
  lcd.print(" %");
  delay(5000);
  lcd.clear();
  lcd.noBacklight();
  
  Serial.begin(115200);

  // wifi access
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);
  Serial.println();
  Serial.print( "Connecting to Wi-Fi ");
  while (WiFi.status() != WL_CONNECTED)
  {
    Serial.print( " . " );
    delay(300);
  }
  Serial.println();
  Serial.print(" Connected with IP: ");
  Serial.println(WiFi.localIP());
  Serial.println();

  // firebase access / settings
  Firebase.begin(FIREBASE_HOST, FIREBASE_AUTH);
  Firebase.reconnectWiFi(true);

  firebaseeData.setBSSLBufferSize(1024,1024);
  firebaseData.setResponseSize(1024);
  Firebase.setReadTimeout(firebaseData, 1000 *60);
  Firebase.setwriteSizeLimit(firebaseData, " tiny ");
}
void loop(){
  
  static int cnt = 0;
  static unsigned long prevTime = 0;
  static unsigned long nowTime = 0;

  // 5초마다 "/esp8266/count" 에 cnt값 보내기 
  nowTime = millis();
  if (nowTime - prevTime >= 5000)
  {
    prevTime = nowTime;
    float A0Val = analogRead(A0);
    Firebase.setFloat(firebaseData, " /esp8266/count ", cnt++);
    Firebase.setInt(firebaseData, " /esp8266/A0 ", A0Val)
  }
}
